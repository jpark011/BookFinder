<div class="container jumbotron" id="course-books">
	<h2><%= @course.subject + ' ' + @course.number %> <span class="small">Section #<%= @course.section %></span></h2>
	<div class="panel panel-primary">
		<div class="panel-heading">
			<h2 class="panel-title">Textbooks</h2>
		</div>
		<div class="panel-body">
			<ul id="textbooks">
			<% # Backbone.js view comes here %>
			</ul>
		</div>
	</div>
</div>
<%= javascript_include_tag "//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js" %>
<%= javascript_include_tag "//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js" %>

<script>
	var Book = Backbone.Model.extend({
		defaults: {
			title: "",
			author: "",
			publisher: "",
			edition: "",
			price: "",
			required: "",
			image: "",
			location: {	floor: "",
									subject: "",
									section: "",
									x: "",
									y: ""
			}
		}
	});

	var BookView = Backbone.View.extend({
		el: "<li class='book row'>",
		model: Book,
		initialize: function () {
			$("#textbooks").append(this.$el);
			this.render();
		},
		render: function () {
			var content = "<div class='media col-xs-3'>" + 
											"<img src='" + this.model.get("image") + "' alt='' />" +
											"<button class='locator'>Locate</button>" +
										"</div>" +
										"<p class='description col-xs-9'>" + 
											"<span class='title'>" + this.model.get("title") + "</span>" + 
											" <span class='edition'>(ed. " + this.model.get("edition") + ")</span>" +
											"<br />by <span class='author'>" + this.model.get("author") + "</span>" +
											"<br /><span class='" + this.model.get("required").toLowerCase() + "'>" + this.model.get("required") + "</span>" + 
										"</p>";
			
			this.$el.html(content);
		},
		events: {
			"click .locator": "locate"
		},
		locate: function (eve) {
			var popup = $("<div id='map-container' class='container'>" +
											"<p class='floor'>Floor " + this.model.get("location").floor + "</p>" +
											"<p class='book-where'>" + 
												"<strong>Subject:</strong> " + this.model.get("location").subject +
												"<br /><strong>Section #:</strong> " + this.model.get("location").section +
											"</p>" +
											"<div class='map" + this.model.get("location").floor + "'>" +
												"<span class='book-pointer glyphicon glyphicon-map-marker' style='top: " + this.model.get("location").y + "%; left: " + this.model.get("location").x + "%;'></span>" +
											"</div>" +
										"</div>"
			);

			popup.dialog({
				width: 360,
				height: 380,
				open: function (eve) {
					var close_btn = this.parentElement.getElementsByClassName("ui-button-text")[0];
					close_btn.textContent = "";
					close_btn.classList.add("glyphicon", "glyphicon-remove");
				},
				close: function () {
					popup.dialog("destroy");
				}
			});

		}
	});
	var arr= [];
	<% @course.books.each do |book| %>
		arr.push(new BookView({model: new Book({	title: "<%= book.title %>", 
																							author: "<%= book.author %>",
																							publisher: "<%= book.publisher %>",
																							edition: "<%= book.edition %>",
																							price: "<%= book.price %>",
																							required: "<%= book.required %>",
																							image: "<%= book.image %>",
																							location: {	floor: "<%= book.location.floor %>",
																													subject: "<%= book.location.subject %>",
																													section: "<%= book.location.section %>",
																													x: <%= book.location.x %>,
																													y: <%= book.location.y %>
																							} })}));
	<% end %>
</script>

